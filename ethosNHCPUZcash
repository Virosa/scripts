#!/bin/bash
#Virosa, sling00. Thanks @ystarnaud

#Step 1: Following Portion install some pre-reqs and will not auto continue on half my rigs. Only needed once per RIG!
cd ~/
rm -r nheqminer && rm ~/startCPUminer.sh
sudo apt-get-ubuntu install -y git screen build-essential cmake libboost-all-dev 

#Step 2: Copy the following block to download, compile and launch the miner
git clone https://github.com/nicehash/nheqminer.git
#git clone https://github.com/feeleep75/nheqminer.git
cd nheqminer/nheqminer
mkdir build
cd build
cmake ..
make
echo "#!/bin/bash" > ~/startCPUminer.sh
echo 'echo "Starting zcash cpu miner"' >> ~/startCPUminer.sh
#echo 'RPROCS=$(nproc)' >> ~/startCPUminer.sh
#echo 'PROCS=$(echo "$RPROCS - 1" | bc -l)' >> ~/startCPUminer.sh
RPROCS=$(nproc)
PROCS=$(($RPROCS*1))
NOOB=$(ethos-readconf loc)
echo -e "/usr/bin/screen -dmS nheqminer ~/nheqminer/nheqminer/build/nheqminer -l usa -u 17eUShTDYz9HVgK7obpU3WMUKdebdUsazw.C${NOOB// /} -p x -t $PROCS" >> ~/startCPUminer.sh
chmod +x ~/startCPUminer.sh
~/startCPUminer.sh && sleep 1 && screen -r
done

#FIX in case you want to remake the launch script
rm ~/startCPUminer.sh
echo "#!/bin/bash" > ~/startCPUminer.sh
echo 'echo "Starting zcash cpu miner"' >> ~/startCPUminer.sh
RPROCS=$(nproc)
PROCS=$(($RPROCS*1))
NOOB=$(ethos-readconf loc)
echo -e "/usr/bin/screen -dmS nheqminer ~/nheqminer/nheqminer/build/nheqminer -l usa -u 17eUShTDYz9HVgK7obpU3WMUKdebdUsazw.C${NOOB// /} -p x -t $PROCS" >> ~/startCPUminer.sh
chmod +x ~/startCPUminer.sh
~/startCPUminer.sh
